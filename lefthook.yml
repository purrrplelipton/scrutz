# Lefthook configuration for code quality
# https://lefthook.dev/configuration/

# Pre-commit hooks - run on every commit
pre-commit:
  parallel: true
  jobs:
    - name: Lint and format staged files
      glob: "*.{js,jsx,ts,tsx,json,css}"
      run: pnpm biome check --write --no-errors-on-unmatched --files-ignore-unknown=true {staged_files}
      stage_fixed: true

    - name: Type check
      glob: "*.{ts,tsx}"
      run: pnpm tsc --noEmit

# Pre-push hooks - run before pushing to remote
pre-push:
  parallel: false
  jobs:
    - name: Lint entire codebase
      run: pnpm biome check --write

    - name: Type check all files
      run: pnpm tsc --noEmit

    - name: Build project
      run: pnpm build

    - name: Check for console logs
      glob: "*.{ts,tsx}"
      run: |
        if grep -r "console\\.\\(log\\|debug\\|info\\)" app/; then
          echo "⚠️  Found console statements in code. Please remove them before pushing."
          exit 1
        fi

# Commit message hook - ensure conventional commits
commit-msg:
  jobs:
    - name: Validate commit message
      run: |
        COMMIT_MSG=$(cat {1})
        if ! echo "$COMMIT_MSG" | grep -qE "^(feat|fix|docs|style|refactor|perf|test|chore|build|ci|revert)(\(.+\))?: .+"; then
          echo "❌ Invalid commit message format!"
          echo ""
          echo "Commit message must follow Conventional Commits format:"
          echo "  <type>(<scope>): <subject>"
          echo ""
          echo "Types: feat, fix, docs, style, refactor, perf, test, chore, build, ci, revert"
          echo ""
          echo "Examples:"
          echo "  feat(campaign): add status toggle functionality"
          echo "  fix: resolve date picker validation issue"
          echo "  docs: update README with setup instructions"
          exit 1
        fi
