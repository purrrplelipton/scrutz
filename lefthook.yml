# Lefthook configuration for git hooks
# https://github.com/evilmartians/lefthook

# Pre-commit hook - runs before creating a commit
pre-commit:
  parallel: true
  commands:
    # Format code with Biome
    format:
      glob: "*.{ts,tsx,js,jsx,json}"
      run: pnpm biome format --write {staged_files}
      stage_fixed: true

    # Lint code with Biome
    lint:
      glob: "*.{ts,tsx,js,jsx}"
      run: pnpm biome lint --write {staged_files}
      stage_fixed: true

    # Type check
    typecheck:
      glob: "*.{ts,tsx}"
      run: pnpm tsc --noEmit

# Commit-msg hook - validates commit messages
commit-msg:
  commands:
    commitlint:
      run: pnpm commitlint --edit {1}

# Pre-push hook - runs before pushing to remote
pre-push:
  parallel: false
  commands:
    # Run full check (format, lint, and type check)
    check:
      run: pnpm biome check --write

    # Run tests (skip if no test files)
    test:
      run: pnpm test || true

    # Build the project to ensure it compiles
    build:
      run: pnpm build